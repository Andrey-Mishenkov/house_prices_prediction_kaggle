## Проект: Предсказание цены жилья (House Prices) с использованием LightAutoML
- House Prices Prediction (Task Regression) using LightAutoML

---

## Описание проекта

### Цель проекта
- Построить модель регрессии для предсказания стоимости жилых домов на основе набора данных Kaggle «House Prices: Advanced Regression Techniques».
- Использовать технологию AutoML на базе фреймворка **LightAutoML**.
- Провести полный цикл анализа данных: обработка пропусков, создание новых признаков, обучение и сравнение нескольких конфигураций AutoML.
- Достичь минимальной ошибки **MAE** на тестовой выборке, превзойти базовое целевое значение (15324).

### Данные
- Датасет содержит **1460 объектов** и **81 признак**, описывающих различные характеристики домов (площадь, качество материалов, год постройки, тип фундамента, наличие гаража, бассейна и т.д.).
- Целевая переменная — `SalePrice` (цена продажи в долларах).
- Подробное описание всех признаков приведено в ноутбуке.

---

## Этапы работы

### 1. Загрузка и первичный анализ данных
- Импорт библиотек: `pandas`, `numpy`, `matplotlib`, `seaborn`, `scipy`, а также `lightautoml` для построения моделей.
- Проверка наличия GPU (использовался Tesla T4).
- Функции для статистического анализа: расчёт пропусков, уникальных значений, выбросов (методы IQR и 3σ).

### 2. Предобработка данных
- **Проверка дубликатов** – дубликаты отсутствуют.
- **Анализ пропусков**:
  - Признаки с пропусками >80% (`PoolQC`, `MiscFeature`, `Alley`) удалены.
  - Для остальных пропусков применено заполнение:
    - Категориальные признаки: мода или специальное значение `'Other'`.
    - Числовые признаки: медиана.
- **Удаление малополезного признака** `Utilities` (99.9% значений `AllPub`).

### 3. Разведочный анализ (EDA)
- Построена корреляционная матрица числовых признаков, выявлены наиболее коррелирующие с целевой переменной (`OverallQual`, `GrLivArea`, `GarageCars` и др.).
- Визуализация распределения цен по месяцам продаж, анализ сезонности.

### 4. Feature engineering (создание новых признаков)
Разработаны функции для генерации дополнительных признаков, улучшающих предсказательную способность:
- **Площадные характеристики**: `TotalSF` (общая площадь), `TotalPorchSF` (сумма площадей всех веранд).
- **Ванные комнаты**: `TotalBath` (общее количество условных ванных с учётом полуванн).
- **Возрастные признаки**: `HouseAge` (возраст дома на момент продажи), `YearsSinceRemodel` (лет после ремонта), бинарный `IsRemodeled`.
- **Бинарные признаки наличия**: `HasPool`, `HasFence`, `Has2ndFloor`, `HasFireplace`, `HasGarage`, `HasBsmt`.
- **Временные признаки**: тригонометрические кодировки месяца (`MonthSin`, `MonthCos`), сезон, квартал, признак популярного месяца продаж.
- **Взаимодействия**: `OverallQual` × различные площади, `OverallQual` × `YearBuilt`, `OverallQual` × `TotalBath`.
- **Комбинированное качество**: `TotalQuality` = `OverallQual` + `OverallCond`.

Всего создано **26 новых признаков**, многие из которых показали высокую корреляцию с целевой переменной (например, `OverallQual_x_TotalSF` с корреляцией 0.856).

### 5. Подготовка обучающей и тестовой выборок
- Целевая переменная разбита на 8 интервалов (стратификация) для сохранения распределения цен при разделении.
- Выполнено стратифицированное разбиение: **80% – обучение (1168 объектов)**, **20% – тест (292 объекта)**.

### 6. Построение моделей с помощью LightAutoML
Использован пресет `TabularAutoML` для задачи регрессии с метрикой **MAE**.

#### Модель 1 (базовая)
- **Параметры**: `timeout = 300` сек, `cv = 5`, `cpu_limit = 1`, `gpu_ids = '0'`.
- **Роли**: только указание целевой переменной и столбца `Id` для удаления.
- **Результаты**:
  - MAE на train (out-of-fold): **14945**
  - MAE на test: **13621**
  - Время обучения: **125 сек**
- **Важность признаков**: в режиме `fast` лидируют `OverallQual_x_TotalSF`, `OverallQual_x_GrLivArea`, `GarageArea`, `LotArea`.

#### Модель 2 (улучшенная)
- **Параметры**: `timeout = 1800` сек, `cv = 7`, расширенный список алгоритмов (`linear_l2`, `lgb`, `lgb_tuned`, `cb`, `cb_tuned`, `xgb`, `xgb_tuned`), увеличенное время на тюнинг.
- **Роли**: вручную заданы категориальные признаки (качество, бинарные переменные, `MSSubClass`), удалены `MoSold`, `YrSold`, `Utilities`.
- **Результаты**:
  - MAE на train: **14687**
  - MAE на test: **13427**
  - Время обучения: **1312 сек**
- **Структура финального ансамбля**:
  - 46.9% – линейная модель (L2)
  - 5.7% – tuned LightGBM
  - 17.1% – CatBoost
  - 30.2% – tuned XGBoost
- **Важность признаков**: в точном режиме (`accurate`) наибольший вклад у `OverallQual_x_TotalSF`, `OverallQual_x_GrLivArea`, `TotalQuality`, `OverallQual_x_TotalBath`, `TotalSF`.

### 7. Анализ важности признаков
- Для обеих моделей построены графики важности в двух режимах (`fast` – приближённый, `accurate` – точный перебор с удалением признаков).
- Подтверждено, что созданные комбинированные признаки (особенно взаимодействия с `OverallQual`) являются ключевыми для предсказания.

---

## Результаты

| Модель                     | MAE (train) | MAE (test) | Время обучения, с |
|----------------------------|-------------|------------|-------------------|
| TabularAutoML (базовая)    | 14945       | 13621      | 125               |
| TabularAutoML (улучшенная) | 14687       | 13427      | 1312              |

- **Обе модели превзошли целевое значение MAE = 15324** на тестовой выборке.
- Улучшенная модель показала прирост качества на **-258** по train и **-194** по test за счёт:
  - более тщательной настройки ролей признаков,
  - увеличения числа фолдов кросс-валидации,
  - добавления XGBoost и его тюнинга,
  - большего времени обучения (21 минута против 2 минут).

### Лучшая модель
- **TabularAutoML (улучшенная)** с финальным ансамблем из 4 алгоритмов.
- MAE на тесте: **13 427**.
- Ключевые признаки: `OverallQual_x_TotalSF`, `OverallQual_x_GrLivArea`, `TotalQuality`, `OverallQual_x_TotalBath`, `TotalSF`.

---

## Выводы

1. **Цель достигнута** – построена модель, предсказывающая стоимость домов с MAE ~13 400, что значительно ниже baseline.
2. **Feature engineering сыграл решающую роль** – созданные признаки-взаимодействия и агрегированные метрики оказались наиболее информативными.
3. **LightAutoML показал высокую эффективность** – автоматический подбор алгоритмов, ансамблирование и тюнинг позволили без ручного перебора получить качественную модель.
4. **Увеличение времени обучения и настройка ролей** дали ощутимое улучшение, что оправдывает затраты вычислительных ресурсов.
5. Полученная модель может быть использована для оценки стоимости недвижимости на основе имеющихся характеристик.

---

## Структура проекта
- `house_prices_prediction.ipynb` – Jupyter ноутбук с полным циклом: EDA, предобработка, feature engineering, обучение двух моделей AutoML, анализ важности признаков.
- `train.csv` – исходные данные (не включены в репозиторий).
- `README.md` – описание проекта.
